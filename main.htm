<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Субо: Хроники Финансового Алхимика</title>
    <style>
        :root {
            /* Базовые цвета */
            --bg-body: #f0f2f5;
            --glass-bg: rgba(255, 255, 255, 0.95);
            --text-color: #333;
            --text-secondary: #666;
            --container-shadow: 0 15px 35px rgba(0,0,0,0.2);
            --header-border: rgba(0,0,0,0.1);
            --switcher-bg: #fff;
            --switcher-hover: #f0f0f0;
            --switcher-shadow: 0 5px 15px rgba(0,0,0,0.1);
            
            /* Цвета кнопок */
            --grad-intro: linear-gradient(to right, #bdc3c7, #2c3e50);
            --color-intro: #2c3e50;
            --grad-child: linear-gradient(to right, #56ab2f, #a8e063);
            --color-child: #56ab2f;
            --grad-pranks: linear-gradient(to right, #f7971e, #ffd200);
            --color-pranks: #f7971e;
            --grad-scam: linear-gradient(to right, #ff416c, #ff4b2b);
            --color-scam: #ff416c;
            --grad-law: linear-gradient(to right, #36d1dc, #5b86e5);
            --color-law: #5b86e5;
            --grad-dubai: linear-gradient(to right, #000000, #434343);
            --color-dubai: #000000;
            --color-dubai-accent: gold;

            --grad-moon: linear-gradient(135deg, #8e2de2, #4a00e0);
            --grad-sun: linear-gradient(135deg, #f7971e, #ffd200);
            --color-device: #95a5a6;

            /* === ПЕРЕМЕННЫЕ ФОНОВ (ПО УМОЛЧАНИЮ СВЕТЛЫЕ) === */
            --bg-img-childhood: linear-gradient(rgba(255,255,255,0.4), rgba(255,255,255,0.4)), url('1.avif');
            --bg-img-pranks: linear-gradient(rgba(255,255,255,0.5), rgba(255,255,255,0.5)), url('7.avif');
            --bg-img-scam: linear-gradient(rgba(255,255,255,0.6), rgba(255,255,255,0.6)), url('8.avif');
            --bg-img-law: linear-gradient(rgba(255,255,255,0.5), rgba(255,255,255,0.5)), url('9.avif');
            --bg-img-dubai: linear-gradient(rgba(255,255,255,0.3), rgba(255,255,255,0.3)), url('6.avif');
        }

        /* Класс темной темы (принудительный) */
        body.dark-theme {
            --bg-body: #121212;
            --glass-bg: rgba(30, 30, 30, 0.95);
            --text-color: #e0e0e0;
            --text-secondary: #aaa;
            --container-shadow: 0 15px 35px rgba(0,0,0,0.6);
            --header-border: rgba(255,255,255,0.1);
            --switcher-bg: #2c2c2c;
            --switcher-hover: #3a3a3a;
            --switcher-shadow: 0 5px 15px rgba(0,0,0,0.5);

            /* Фоны для темной темы */
            --bg-img-childhood: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('4.avif');
            --bg-img-pranks: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('5.avif');
            --bg-img-scam: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('2.avif');
            --bg-img-law: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('3.avif');
            --bg-img-dubai: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('9.avif');
        }
        
        /* Системная темная тема (если не выбрана светлая вручную) */
        @media (prefers-color-scheme: dark) {
            body:not(.light-theme) {
                --bg-body: #121212;
                --glass-bg: rgba(30, 30, 30, 0.95);
                --text-color: #e0e0e0;
                --text-secondary: #aaa;
                --container-shadow: 0 15px 35px rgba(0,0,0,0.6);
                --header-border: rgba(255,255,255,0.1);
                --switcher-bg: #2c2c2c;
                --switcher-hover: #3a3a3a;
                --switcher-shadow: 0 5px 15px rgba(0,0,0,0.5);

                /* Фоны для системной темной темы */
                --bg-img-childhood: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('4.avif');
                --bg-img-pranks: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('5.avif');
                --bg-img-scam: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('2.avif');
                --bg-img-law: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('3.avif');
                --bg-img-dubai: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('9.avif');
            }
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body); 
            /* Значения по умолчанию */
            background-image: none;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            color: var(--text-color);
            min-height: 100vh;
            display: flex; justify-content: center; align-items: flex-start;
            transition: background-color 0.3s, color 0.3s, background-image 0.5s ease-in-out;
        }

        /* === ПРИМЕНЕНИЕ ПЕРЕМЕННЫХ ФОНОВ === */
        body[data-active-tab="intro"] { background-image: none; }
        body[data-active-tab="childhood"] { background-image: var(--bg-img-childhood); }
        body[data-active-tab="pranks"] { background-image: var(--bg-img-pranks); }
        body[data-active-tab="scam"] { background-image: var(--bg-img-scam); }
        body[data-active-tab="law"] { background-image: var(--bg-img-law); }
        body[data-active-tab="dubai"] { background-image: var(--bg-img-dubai); }

        body.no-scroll { overflow: hidden; height: 100vh; }

        .container {
            width: 90%; max-width: 1000px;
            background: var(--glass-bg);
            margin: 40px auto; border-radius: 20px;
            box-shadow: var(--container-shadow);
            overflow: hidden; 
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            animation: fadeIn 0.8s ease-out; transition: background 0.3s;
        }

        header { text-align: center; padding: 40px 20px; border-bottom: 1px solid var(--header-border); }
        h1 { margin: 0; font-size: 2.5em; background: -webkit-linear-gradient(#4a00e0, #8e2de2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-transform: uppercase; letter-spacing: 2px; }
        .subtitle { font-size: 1.1em; margin-top: 10px; color: var(--text-secondary); font-style: italic; }

        .nav-buttons {
            display: flex; flex-wrap: wrap; justify-content: center;
            padding: 20px; gap: 15px; background: rgba(0,0,0,0.03);
            position: sticky; top: 0; z-index: 100; 
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .nav-btn {
            background: transparent; padding: 12px 20px;
            border-radius: 30px; cursor: pointer;
            font-weight: bold; font-size: 0.9em;
            transition: all 0.4s ease; position: relative;
        }
        .nav-btn:hover { transform: translateY(-2px); box-shadow: 0 0 15px rgba(128, 128, 128, 0.4); }

        .btn-intro { border: 2px solid var(--color-intro); color: var(--color-intro); }
        body.dark-theme .btn-intro, body:not(.light-theme) .btn-intro { border-color: #bdc3c7; color: #bdc3c7; }
        .btn-intro.active { background: var(--grad-intro); color: white; border-color: transparent; box-shadow: 0 0 20px var(--color-intro); background-origin: border-box; }
        
        .btn-child { border: 2px solid var(--color-child); color: var(--color-child); }
        .btn-child.active { background: var(--grad-child); color: white; border-color: transparent; box-shadow: 0 0 20px var(--color-child); background-origin: border-box; }
        
        .btn-pranks { border: 2px solid var(--color-pranks); color: var(--color-pranks); }
        .btn-pranks.active { background: var(--grad-pranks); color: white; border-color: transparent; box-shadow: 0 0 20px var(--color-pranks); background-origin: border-box; }
        
        .btn-scam { border: 2px solid var(--color-scam); color: var(--color-scam); }
        .btn-scam.active { background: var(--grad-scam); color: white; border-color: transparent; box-shadow: 0 0 20px var(--color-scam); background-origin: border-box; }
        
        .btn-law { border: 2px solid var(--color-law); color: var(--color-law); }
        .btn-law.active { background: var(--grad-law); color: white; border-color: transparent; box-shadow: 0 0 20px var(--color-law); background-origin: border-box; }
        
        .btn-dubai { border: 1px solid var(--color-dubai-accent); color: var(--color-dubai-accent); }
        .btn-dubai.active { background: var(--grad-dubai); color: var(--color-dubai-accent); border: 1px solid var(--color-dubai-accent); box-shadow: 0 0 20px var(--color-dubai-accent); background-origin: border-box; }

        .content-area { padding: 40px; line-height: 1.8; font-size: 1.05em; }
        .tab-content { display: none; animation: slideUp 0.5s ease; }
        .tab-content.active { display: block; }
        h2 { margin-top: 0; border-left: 5px solid; padding-left: 15px; margin-bottom: 20px; }
        h3 { margin-top: 25px; margin-bottom: 10px; color: var(--text-color); font-weight: 700; }
        p, li { margin-bottom: 15px; }
        
        .table-wrapper { width: 100%; overflow-x: auto; margin: 25px 0; border-radius: 8px; box-shadow: 0 0 20px rgba(0, 0, 0, 0.05); }
        table {
            width: 100%; border-collapse: collapse; min-width: 600px;
            font-size: 0.9em; 
        }
        table thead tr { background-color: rgba(0,0,0,0.05); text-align: left; }
        body.dark-theme table thead tr, body:not(.light-theme) table thead tr { background-color: rgba(255,255,255,0.1); }
        table th, table td { padding: 12px 15px; border-bottom: 1px solid var(--header-border); }
        table tbody tr:last-of-type { border-bottom: 2px solid var(--header-border); }
        table th { font-weight: bold; color: var(--text-color); }
        
        .content-media {
            width: 100%; height: auto; max-width: 100%;
            border-radius: 10px; border: 3px solid #ccc;
            margin: 25px 0; display: block;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: border-color 0.5s ease;
        }

        img.content-media {
            opacity: 0; 
            transform: scale(0.98);
            transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1), transform 0.8s cubic-bezier(0.4, 0, 0.2, 1), border-color 0.5s ease;
        }
        
        img.content-media.loaded {
            opacity: 1; 
            transform: scale(1);
        }

        .video-modal-overlay {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.96); z-index: 9999;
            justify-content: center; align-items: center; flex-direction: column;
            opacity: 0; transition: opacity 0.8s ease;
            will-change: opacity;
            touch-action: none;
        }
        .video-modal-overlay.open { display: flex; opacity: 1; }
        
        .video-container {
            width: 80%; max-width: 900px; aspect-ratio: 16 / 9;
            background: black; border: none;
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.1); position: relative;
            opacity: 0; transform: scale(0.9);
            transition: opacity 0.5s ease, transform 0.5s ease, aspect-ratio 0.3s, max-width 0.3s;
            will-change: transform, opacity;
        }
        
        .video-container.vertical { aspect-ratio: 9 / 16; max-width: 450px; }
        .video-container.visible { opacity: 1; transform: scale(1); }
        .video-container video { width: 100%; height: 100%; object-fit: cover; border-radius: 0; }
        
        .close-modal-btn {
            position: absolute; top: -40px; right: -40px;
            color: white; font-size: 40px; cursor: pointer;
            display: none; transition: transform 0.3s; z-index: 10001;
            padding: 10px;
        }
        .close-modal-btn:hover { transform: scale(1.2) rotate(90deg); color: red; }

        .theme-switcher-container { position: fixed; top: 20px; right: 20px; z-index: 1000; }
        .theme-btn-main {
            width: 50px; height: 50px; border-radius: 50%;
            background: var(--switcher-bg); box-shadow: var(--switcher-shadow);
            cursor: pointer; position: relative; border: 1px solid var(--header-border);
            transition: background 0.3s, border-color 0.3s;
        }
        .theme-btn-main.mode-device:not(:hover) { background: var(--color-device); border-color: transparent; }
        .theme-btn-main.mode-light:not(:hover) { background: var(--grad-sun); border-color: transparent; }
        .theme-btn-main.mode-dark:not(:hover) { background: var(--grad-moon); border-color: transparent; }
        .theme-switcher-container.menu-open .theme-btn-main { background: var(--switcher-bg) !important; border-color: var(--header-border) !important; }

        .icon-wrapper {
            position: absolute; inset: 0; margin: auto; width: 24px; height: 24px;
            display: flex; align-items: center; justify-content: center; transition: opacity 0.3s;
        }
        .icon-wrapper svg { width: 100%; height: 100%; fill: var(--text-color); transition: fill 0.3s; }
        .theme-btn-main.mode-device:not(:hover) .icon-current svg,
        .theme-btn-main.mode-light:not(:hover) .icon-current svg,
        .theme-btn-main.mode-dark:not(:hover) .icon-current svg { fill: white; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.2)); }
        .icon-gear { opacity: 0; pointer-events: none; }
        .theme-btn-main:hover .icon-current { opacity: 0; }
        .theme-btn-main:hover .icon-gear { opacity: 1; animation: spinGear 2s linear infinite; }
        .theme-switcher-container.menu-open .theme-btn-main .icon-current { opacity: 0; }
        .theme-switcher-container.menu-open .theme-btn-main .icon-gear { opacity: 1; animation: none; }
        .theme-switcher-container.menu-open .theme-btn-main:hover .icon-gear { animation: spinGear 2s linear infinite; }
        @keyframes spinGear { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .theme-menu {
            position: absolute; top: 60px; right: 0;
            background: var(--switcher-bg);
            border-radius: 15px; padding: 10px; width: 200px;
            box-shadow: var(--switcher-shadow);
            display: flex; flex-direction: column; gap: 5px;
            transform-origin: top right;
            transform: scale(0); opacity: 0;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s;
            pointer-events: none; border: 1px solid var(--header-border);
            will-change: transform, opacity;
        }
        .theme-switcher-container.menu-open .theme-menu { transform: scale(1); opacity: 1; pointer-events: all; }
        .theme-option {
            display: flex; align-items: center; gap: 10px;
            padding: 10px 15px; border-radius: 10px; cursor: pointer;
            transition: background 0.2s; color: var(--text-color);
            font-size: 0.9em; font-weight: 500;
        }
        .theme-option:hover { background: var(--switcher-hover); }
        .theme-option svg { width: 20px; height: 20px; fill: var(--text-color); }
        
        .anim-jump svg { animation: jumpMonitor 0.5s ease; }
        @keyframes jumpMonitor { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .anim-shine svg { animation: sunShine 0.8s ease; fill: orange; }
        @keyframes sunShine { 0% { transform: scale(1) rotate(0); filter: drop-shadow(0 0 0 transparent); } 50% { transform: scale(1.3) rotate(180deg); filter: drop-shadow(0 0 10px gold); } 100% { transform: scale(1) rotate(360deg); filter: drop-shadow(0 0 0 transparent); } }
        .anim-moon svg { animation: moonMagic 1s forwards; }
        @keyframes moonMagic { 0% { transform: rotate(0) scale(1); fill: var(--text-color); } 50% { transform: rotate(-25deg) scale(1.2) translateZ(-10px); } 100% { transform: rotate(0) scale(1); fill: url(#moonGradient); } }

        @media (max-width: 768px) {
            .video-container { width: 95%; }
            .close-modal-btn { right: 0; top: -50px; display: block; }
            h1 { font-size: 1.8em; }
            .nav-buttons { flex-direction: column; }
            .nav-btn { width: 100%; box-sizing: border-box; text-align: center; }
            .theme-switcher-container { top: 10px; right: 10px; }
            th, td { padding: 8px 5px; }
            .content-area { padding: 20px; }
            /* На мобильных фиксированный фон может дергаться, лучше скролл */
            body { background-attachment: scroll; }
        }

        footer { text-align: center; padding: 20px; font-size: 0.8em; color: var(--text-secondary); border-top: 1px solid var(--header-border); }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        #interactionBlocker {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 9998;
            display: none;
            background: transparent; 
            cursor: wait;
        }

        body.locked {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        body.locked #interactionBlocker { display: block; }
        body.locked .nav-btn:hover { transform: none; box-shadow: none; cursor: not-allowed; }
        body.locked a, body.locked button { cursor: not-allowed; }
    </style>
</head>
<body data-active-tab="intro">
<div id="interactionBlocker"></div>
<svg style="width:0;height:0;position:absolute;" aria-hidden="true" focusable="false">
  <linearGradient id="moonGradient" x1="0%" y1="0%" x2="100%" y2="100%">
    <stop offset="0%" style="stop-color:#8e2de2;stop-opacity:1" />
    <stop offset="100%" style="stop-color:#4a00e0;stop-opacity:1" />
  </linearGradient>
</svg>

<!-- Audio elements -->
<audio id="sound-intro" src="intro.opus" preload="none"></audio>
<audio id="sound-child" src="childhood.m4a" preload="none"></audio>
<audio id="sound-pranks" src="prank.m4a" preload="none"></audio>
<audio id="sound-scam" src="scam.m4a" preload="none"></audio>
<audio id="sound-law" src="law.m4a" preload="none"></audio>
<audio id="sound-dubai" src="dubai.m4a" preload="none"></audio>

<div class="theme-switcher-container" id="themeSwitcher">
    <div class="theme-btn-main" id="themeBtnMain">
        <div id="currentThemeIcon" class="icon-wrapper icon-current"></div>
        <div class="icon-wrapper icon-gear">
            <svg viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>
        </div>
    </div>

    <div class="theme-menu" id="themeMenu">
        <div class="theme-option" id="opt-device" data-theme="device">
            <svg viewBox="0 0 24 24"><path d="M21,2H3C1.9,2,1,2.9,1,4v12c0,1.1,0.9,2,2,2h7v2H8v2h8v-2h-2v-2h7c1.1,0,2-0.9,2-2V4C23,2.9,22.1,2,21,2z M21,16H3V4h18 V16z"/></svg>
            Как на устройстве
        </div>
        <div class="theme-option" id="opt-light" data-theme="light">
            <svg viewBox="0 0 24 24"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"/></svg>
            Белая тема
        </div>
        <div class="theme-option" id="opt-dark" data-theme="dark">
            <svg viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>
            Темная тема
        </div>
    </div>
</div>

<div id="videoModal" class="video-modal-overlay">
    <div class="video-container" id="videoContainer">
        <div id="closeModal" class="close-modal-btn">&times;</div>
        <!-- playsinline added for iOS support -->
        <video id="modalVideo" controls disablePictureInPicture controlsList="nodownload" playsinline></video>
    </div>
</div>

<div class="container">
    <header>
        <h1>Субо: Летопись Великого Пранкера</h1>
        <div class="subtitle">Финансовый Алхимик, Хрупкая Орхидея и Мастер Апперкота Судьбы</div>
    </header>

    <nav class="nav-buttons" id="navContainer">
        <button class="nav-btn btn-intro active" data-tab="intro" data-sound="sound-intro">Вступление</button>
        <button class="nav-btn btn-child" data-tab="childhood" data-sound="sound-child">Детство и Травля</button>
        <button class="nav-btn btn-pranks" data-tab="pranks" data-sound="sound-pranks">Эпоха Пранков</button>
        <button class="nav-btn btn-scam" data-tab="scam" data-sound="sound-scam">Инфобиз и "Музыка"</button>
        <button class="nav-btn btn-law" data-tab="law" data-sound="sound-law">Закон и Порядок</button>
        <button class="nav-btn btn-dubai" data-tab="dubai" data-sound="sound-dubai">Дубайское Фиаско</button>
    </nav>

    <main class="content-area" id="mainContent">
        <div id="intro" class="tab-content active">
            <h2 style="border-color: var(--color-intro);">Сага о «Великом Страдальце»: Жизнь и Приключения Субхана Мамедова</h2>
            <img src="1.jpg" class="content-media" style="border-color: var(--color-intro);" alt="Intro start" loading="lazy">
            <h3>Или как превратить биографию в сборник судебных исков и синяков</h3>
            <p>Встречайте, уважаемые зрители этого цирка под названием «Жизнь», главного героя нашей трагикомедии — Субхана «Subo» Мамедова! В мире интернета, где каждый второй считает себя непризнанным гением, Субо братик занимает почетное место живого доказательства того, что слава может прийти даже к тем, кто путает юмор с глупостью, а бизнес — с банальным обманом.</p>
            <img src="2.jpg" class="content-media" style="border-color: var(--color-intro);" alt="Deception" loading="lazy">
            <p>Этот парень — воплощение «американской мечты» в суровом варианте: путь от школьного хулигана до блогера-миллионника, а затем — в вечного странника по чужим паспортам, травмпунктам и черным спискам МВД. Его история — это не просто биография, а полноценный триллер с элементами комедии абсурда, где главный злодей — он сам, а жертвы — все вокруг, включая зеркало.</p>
            <video src="1.mp4" controls class="content-media" style="border-color: var(--color-intro);" preload="none" playsinline></video>
            <p>Субо Мамедов — это ходячая ирония: ранимая «орхидея» в броне из наглости, финансовый гуру без задекларированных доходов и пранкер, который не выдержал собственной шутки.</p>
            <img src="3.jpg" class="content-media" style="border-color: var(--color-intro);" alt="Intro bottom" loading="lazy">
        </div>

        <div id="childhood" class="tab-content">
            <h2 style="border-color: var(--color-child);">Детство и травля: Рождение «Легенды»</h2>
            <p>31 июля 1999 года в Москве, в семье азербайджанских эмигрантов, раздался крик, который эхом отозвался в будущем по всем полицейским участкам страны.</p>
            <p>С раннего детства Субо проявлял задатки великого актера: плакал громче всех, требовал внимания и виртуозно манипулировал окружающими.</p>
            <p>Школа для Субо братика стала полигоном для тестирования границ человеческой терпимости. Здесь проявился главный парадокс его личности: он часто жаловался, что его травили, но сам с упоением превращал жизнь других в ад.</p>
            <p>В 6-м классе, когда нормальные дети открывали для себя Minecraft, Субо и его верный оруженосец Михаил Литвин открыли YouTube.</p>
            <img src="4.jpg" class="content-media" style="border-color: var(--color-child);" alt="Police explanation" loading="lazy">
            <p>Годы спустя, уже в статусе «звезды», Субо решил вернуться в родную школу, ожидая ковровую дорожку. Но реальность ударила больнее, чем он ожидал.</p>
            <video src="2.mp4" controls class="content-media" style="border-color: var(--color-child);" preload="none" playsinline></video>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Этап жизни</th><th>«Достижения»</th><th>Последствия для окружающих</th><th>Итог для Субо</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><b>Начальная школа</b></td><td>Манипуляции родителями</td><td>Головная боль учителей</td><td>Синдром «мне все должны»</td></tr>
                        <tr><td><b>Средняя школа</b></td><td>Дебют на YouTube, полиция</td><td>Шок у педагогов</td><td>Вера в безнаказанность</td></tr>
                        <tr><td><b>Старшие классы</b></td><td>Травля слабых</td><td>Страдания жертв</td><td>Комплексы</td></tr>
                        <tr><td><b>Возвращение</b></td><td>Попытка хайпа в школе</td><td>Отказ администрации</td><td>Публичное унижение</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="pranks" class="tab-content">
            <h2 style="border-color: var(--color-pranks);">Эпоха Великих Пранков</h2>
            <img src="5.jpg" class="content-media" style="border-color: var(--color-pranks);" alt="Prank start" loading="lazy">
            <p>Воодушевленный первыми просмотрами, Субо превратил улицы Москвы в свою личную съемочную площадку. Полицейские участки стали для него вторым домом.</p>
            <ul>
                <li><strong>Вламывался на кухни ресторанов</strong></li>
                <li><strong>Катался на крышах авто</strong></li>
                <li><strong>Футбольный фейл:</strong> Попытка выбежать на поле во время матча ЛЧ.</li>
                <li><strong>Поджог ночлежки:</strong> «Кринж на грани преступления».</li>
            </ul>
            <video src="3.mp4" controls class="content-media" style="border-color: var(--color-pranks);" preload="none" playsinline></video>
            <p>Отдельного упоминания заслуживает его карьера «таксиста на Lamborghini».</p>
            <ul>
                <li><em>Субо:</em> «Девушка, а вы верите в любовь с первого взгляда?»</li>
                <li><em>Девушка:</em> «Я верю в то, что хочу выйти из машины».</li>
            </ul>
            <video src="4.mp4" controls class="content-media" style="border-color: var(--color-pranks);" preload="none" playsinline></video>
        </div>

        <div id="scam" class="tab-content">
            <h2 style="border-color: var(--color-scam);">Финансовый Гуру, Музыкальный Пророк</h2>
            <video src="5.mp4" controls class="content-media" style="border-color: var(--color-scam);" preload="none" playsinline></video>
            <p>Пранки — это весело, но на штрафы нужны деньги. Субо стал финансовым наставником для школьников, щедро рекламируя <a href="#" onclick="return false;" style="cursor: not-allowed; text-decoration: line-through;">онлайн-казино</a> и ставки.</p>
            <p>А музыка? Треки вроде «Гелик катится» взорвали чарты, доказав, что автотюн способен скрыть отсутствие слуха.</p>
            <img src="6.jpg" class="content-media" style="border-color: var(--color-scam);" alt="Crocodile tears" loading="lazy">
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Тип «Бизнеса»</th><th>Суть деятельности</th><th>Реальный результат</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><b>Реклама казино</b></td><td>Стримы, рефералки</td><td>Обогащение за счет подписчиков</td></tr>
                        <tr><td><b>Каперство</b></td><td>Прогнозы «100%»</td><td>Массовый обман (скам)</td></tr>
                        <tr><td><b>Музыка</b></td><td>Треки про деньги</td><td>Кратковременный хайп</td></tr>
                        <tr><td><b>Бургерная</b></td><td>Общепит</td><td>Закрытие</td></tr>
                        <tr><td><b>Giveaway</b></td><td>«Раздача» машин</td><td>Обвинения в невыдаче</td></tr>
                    </tbody>
                </table>
            </div>
            <img src="7.jpg" class="content-media" style="border-color: var(--color-scam);" alt="Scam bottom" loading="lazy">
        </div>

        <div id="law" class="tab-content">
            <h2 style="border-color: var(--color-law);">2025 Год — Судный День</h2>
            <video src="6.mp4" controls class="content-media" style="border-color: var(--color-law);" preload="none" playsinline></video>
            <p>2025 год стал для Субо годом «кармического нокаута».</p>
            <ol>
                <li><strong>Лишение гражданства (Февраль 2025):</strong> Ложные данные при получении.</li>
                <li><strong>Запрет на въезд:</strong> На 70 лет. До 2095 года.</li>
                <li><strong>Уголовное дело (Июль 2025):</strong> Налоги на 50 млн рублей.</li>
                <li><strong>Банкротство:</strong> Долги и дутая репутация.</li>
            </ol>
            <p>Субо бежал в Дубай, откуда начал вещать о несправедливости мира.</p>
            <img src="8.jpg" class="content-media" style="border-color: var(--color-law);" alt="Law photo" loading="lazy">
            <video src="7.mp4" controls class="content-media" style="border-color: var(--color-law);" preload="none" playsinline></video>
        </div>

        <div id="dubai" class="tab-content">
            <h2 style="border-color: gold; color: gold;">Дубайский Пранк над Самим Собой</h2>
            <img src="10.avif" class="content-media" style="border-color: gold;" alt="Dubai start" loading="lazy">
            <p>В ноябре 2025 года Субо решил «пошутить» над бойцом Шовхалом Абдурахмановым.</p>
            <p>Шутка не зашла. Реакция была мгновенной: серия ударов отправила пранкера в полет. Далее следовала сцена извинений на коленях.</p>
            <p>Здесь и раскрылся парадокс Субо: он сломался от первого же реального отпора.</p>
            <video src="8.mp4" controls class="content-media" style="border-color: gold;" preload="none" playsinline></video>
            <h3>Эпилог: Карма — Дама с Тяжелым Кулаком</h3>
            <p>Жизнь Субхана Мамедова — пособие о том, как не надо жить.</p>
            <img src="11.avif" class="content-media" style="border-color: gold;" alt="Dubai s" loading="lazy">
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Скандал</th><th>Год</th><th>Суть</th><th>Урок</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><b>Травля</b></td><td>2010+</td><td>Унижение</td><td>Всенародный хейт</td></tr>
                        <tr><td><b>Пранки</b></td><td>2015+</td><td>Игры с законом</td><td>Уголовное дело</td></tr>
                        <tr><td><b>Скам</b></td><td>2020+</td><td>Обман</td><td>Долги</td></tr>
                        <tr><td><b>Гражданство</b></td><td>02.2025</td><td>Ложь</td><td>Изгнание</td></tr>
                        <tr><td><b>Дубай</b></td><td>11.2025</td><td>Неудачная шутка</td><td><b>За слова бьют</b></td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <footer>
        <p>© 2025 Летопись Субо. Создано с иронией, без мата, но с болью.</p>
    </footer>
</div>

<script>
(function() {
    'use strict';

    // === КЭШИРОВАНИЕ ЭЛЕМЕНТОВ ===
    const DOM = {
        body: document.body,
        switcher: document.getElementById('themeSwitcher'),
        themeIcon: document.getElementById('currentThemeIcon'),
        themeBtn: document.getElementById('themeBtnMain'),
        themeMenu: document.getElementById('themeMenu'),
        modal: document.getElementById('videoModal'),
        videoContainer: document.getElementById('videoContainer'),
        videoEl: document.getElementById('modalVideo'),
        closeBtn: document.getElementById('closeModal'),
        introTab: document.getElementById('intro'),
        introBtn: document.querySelector('.btn-intro'),
        contentArea: document.getElementById('mainContent'),
        navContainer: document.getElementById('navContainer'),
        audios: {}
    };

    // Сохраняем ссылки на аудио элементы
    document.querySelectorAll('audio').forEach(audio => {
        DOM.audios[audio.id] = audio;
        // Глобальная подстраховка: если аудио ломается, всегда разблокировать
        audio.addEventListener('error', () => {
            console.warn(`Audio ${audio.id} failed to load or decode.`);
            unlockInterface();
        });
    });

    // === КОНФИГУРАЦИЯ ===
    const CONFIG = {
        videoMap: {
            'childhood': 'childhood.webm',
            'pranks': 'prank.webm',
            'scam': 'scam.webm',
            'law': 'law.webm',
            'dubai': 'dubai.webm'
        },
        svgs: {
            device: '<svg viewBox="0 0 24 24"><path d="M21,2H3C1.9,2,1,2.9,1,4v12c0,1.1,0.9,2,2,2h7v2H8v2h8v-2h-2v-2h7c1.1,0,2-0.9,2-2V4C23,2.9,22.1,2,21,2z M21,16H3V4h18 V16z"/></svg>',
            light: '<svg viewBox="0 0 24 24"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"/></svg>',
            dark: '<svg viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>'
        }
    };

    let state = {
        activeTab: DOM.introTab,
        activeBtn: DOM.introBtn,
        canCloseModal: false,
        themeSwitching: false,
        currentAudioHandler: null // Храним ссылку для удаления EventListener
    };

    // === ФУНКЦИИ БЛОКИРОВКИ ===
    function lockInterface() {
        DOM.body.classList.add('locked');
    }

    function unlockInterface() {
        DOM.body.classList.remove('locked');
    }

    // === ЛОГИКА ТЕМ ===
    function applyTheme(themeName) {
        DOM.body.classList.remove('light-theme', 'dark-theme');
        if (themeName === 'light') DOM.body.classList.add('light-theme');
        if (themeName === 'dark') DOM.body.classList.add('dark-theme');

        DOM.themeIcon.innerHTML = CONFIG.svgs[themeName];
        DOM.themeBtn.className = 'theme-btn-main mode-' + themeName;
        localStorage.setItem('site_theme', themeName);
    }

    function setTheme(themeName) {
        if (state.themeSwitching) return;
        state.themeSwitching = true;
        
        const optEl = document.getElementById('opt-' + themeName);
        
        document.querySelectorAll('.theme-option').forEach(el => {
            el.classList.remove('anim-jump', 'anim-shine', 'anim-moon');
        });

        if (themeName === 'device') optEl.classList.add('anim-jump');
        if (themeName === 'light') optEl.classList.add('anim-shine');
        if (themeName === 'dark') optEl.classList.add('anim-moon');

        setTimeout(() => {
            applyTheme(themeName);
            DOM.switcher.classList.remove('menu-open');
            setTimeout(() => {
                optEl.classList.remove('anim-jump', 'anim-shine', 'anim-moon');
                state.themeSwitching = false;
            }, 500);
        }, 800);
    }

    // === ЛОГИКА АУДИО/ВИДЕО ===
    function stopAllContentMedia() {
        // Stop global audio
        Object.values(DOM.audios).forEach(audio => {
            // Важно: Сначала удаляем обработчики, потом пауза
            if (state.currentAudioHandler) {
                audio.removeEventListener('ended', state.currentAudioHandler);
            }
            audio.pause();
            audio.currentTime = 0;
        });
        state.currentAudioHandler = null;

        // Stop embedded videos inside tabs
        const embeddedVideos = document.querySelectorAll('.content-area video');
        embeddedVideos.forEach(v => v.pause());
    }

    function playSound(soundId) {
        stopAllContentMedia();
        const sound = DOM.audios[soundId];
        if (sound) {
            const playPromise = sound.play();
            return { sound, playPromise };
        }
        return null;
    }

    function playVideoSequence(src, tabId, soundId) {
        stopAllContentMedia();
        const storageKey = "subo_video_watched_" + tabId;
        const isWatched = localStorage.getItem(storageKey) === "true";

        // Reset video state
        DOM.videoEl.onpause = null;
        DOM.videoEl.onseeking = null;
        DOM.videoEl.ontimeupdate = null;
        DOM.videoEl.oncontextmenu = null;
        
        DOM.videoEl.src = src;
        
        // Handle visual state
        DOM.videoContainer.classList.remove('visible');
        DOM.closeBtn.style.display = 'none';
        state.canCloseModal = false;

        if (tabId === 'dubai') {
            DOM.videoContainer.classList.add('vertical');
        } else {
            DOM.videoContainer.classList.remove('vertical');
        }

        DOM.modal.classList.add('open');
        DOM.body.classList.add('no-scroll');

        // Logic for watched vs unwatched
        if (isWatched) {
            enableVideoControls(true);
        } else {
            DOM.videoEl.removeAttribute('controls');
            DOM.videoEl.oncontextmenu = (e) => e.preventDefault();
            
            DOM.videoEl.onpause = function() {
                if (!DOM.videoEl.ended && !DOM.videoEl.seeking) {
                    DOM.videoEl.play().catch(e => console.log("Play interrupted"));
                }
            };
        }

        const audioContext = playSound(soundId);
        
        const showVideoContent = () => {
            // Удаляем слушатель, чтобы не сработал дважды
            if (audioContext && state.currentAudioHandler) {
                audioContext.sound.removeEventListener('ended', state.currentAudioHandler);
            }

            DOM.videoContainer.classList.add('visible');
            
            const vPromise = DOM.videoEl.play();
            if (vPromise !== undefined) {
                vPromise.catch(error => {
                    console.warn("Auto-play prevented (video)", error);
                    enableVideoControls(true);
                });
            }
            
            if (isWatched) {
                enableVideoControls(true);
            } else {
                DOM.videoEl.onended = function() {
                    enableVideoControls(true);
                    localStorage.setItem(storageKey, "true");
                    DOM.videoEl.onpause = null;
                };
                
                DOM.videoEl.onerror = function() {
                    console.warn("Video load error");
                    enableVideoControls(true);
                };
            }
        };

        if (audioContext && audioContext.playPromise !== undefined) {
            audioContext.playPromise
                .then(() => {
                    // Сохраняем обработчик, чтобы можно было его удалить при смене вкладки
                    state.currentAudioHandler = showVideoContent;
                    audioContext.sound.addEventListener('ended', showVideoContent, { once: true });
                })
                .catch((error) => {
                    console.warn("Audio play failed, showing video immediately", error);
                    showVideoContent();
                });
        } else {
            // Если аудио нет или ошибка, сразу видео
            setTimeout(showVideoContent, 100);
        }
    }

    function enableVideoControls(allowed) {
        if (allowed) {
            DOM.videoEl.setAttribute('controls', 'controls');
            DOM.videoEl.style.pointerEvents = 'auto';
            DOM.closeBtn.style.display = 'block';
            DOM.videoEl.oncontextmenu = null;
            state.canCloseModal = true;
        }
    }

    function closeVideo() {
        if (!state.canCloseModal) return;

        DOM.modal.classList.remove('open');
        DOM.videoContainer.classList.remove('visible');
        DOM.videoEl.pause();
        
        DOM.videoEl.onpause = null;
        DOM.videoEl.onended = null;
        
        DOM.videoEl.removeAttribute('src'); 
        DOM.videoEl.load();
        
        DOM.body.classList.remove('no-scroll');
        
        stopAllContentMedia();
        
        // Разблокируем интерфейс при закрытии видео
        unlockInterface();
    }

    // === ОБРАБОТЧИКИ СОБЫТИЙ ===
    
    DOM.navContainer.addEventListener('click', function(e) {
        // Если заблокировано, ничего не делаем
        if (DOM.body.classList.contains('locked')) return;

        const btn = e.target.closest('.nav-btn');
        if (!btn) return;

        const tabName = btn.dataset.tab;
        const soundId = btn.dataset.sound;
        const newTab = document.getElementById(tabName);

        if (state.activeTab) state.activeTab.classList.remove('active');
        if (state.activeBtn) state.activeBtn.classList.remove('active');

        newTab.classList.add('active');
        btn.classList.add('active');

        state.activeTab = newTab;
        state.activeBtn = btn;

        DOM.body.setAttribute('data-active-tab', tabName);

        // БЛОКИРУЕМ ИНТЕРФЕЙС ПРИ СТАРТЕ
        lockInterface();

        if (CONFIG.videoMap[tabName]) {
            // Сценарий с видео: Блокировка снимается только при закрытии модального окна
            playVideoSequence(CONFIG.videoMap[tabName], tabName, soundId);
        } else {
            // Сценарий только аудио
            const audioData = playSound(soundId);
            
            const onAudioEnd = () => {
                unlockInterface();
            };

            if (audioData) {
                // Если Promise play() вернет ошибку (например, автоплей запрещен)
                if (audioData.playPromise !== undefined) {
                    audioData.playPromise
                        .then(() => {
                            state.currentAudioHandler = onAudioEnd;
                            audioData.sound.addEventListener('ended', onAudioEnd, { once: true });
                        })
                        .catch((err) => {
                            console.warn('Audio play prevented:', err);
                            unlockInterface(); // Ошибка? Сразу разблокируем
                        });
                } else {
                    // Старые браузеры
                    state.currentAudioHandler = onAudioEnd;
                    audioData.sound.addEventListener('ended', onAudioEnd, { once: true });
                }
            } else {
                // Если аудио элемента нет - сразу разблокируем
                unlockInterface();
            }
        }

        if (window.innerWidth < 768) {
            setTimeout(() => {
                DOM.contentArea.scrollIntoView({behavior: 'smooth', block: 'start'});
            }, 100);
        }
    });

    DOM.themeBtn.addEventListener('click', (e) => {
        if (DOM.body.classList.contains('locked')) return;
        e.stopPropagation();
        DOM.switcher.classList.toggle('menu-open');
    });

    DOM.themeMenu.addEventListener('click', (e) => {
        const option = e.target.closest('.theme-option');
        if (option) {
            setTheme(option.dataset.theme);
        }
    });

    DOM.closeBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        closeVideo();
    });

    DOM.modal.addEventListener('click', (e) => {
        if (e.target === DOM.modal) {
            closeVideo();
        }
    });

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && DOM.modal.classList.contains('open')) {
            closeVideo();
        }
    });

    document.addEventListener('click', (event) => {
        if (!DOM.switcher.contains(event.target) && DOM.switcher.classList.contains('menu-open')) {
            DOM.switcher.classList.remove('menu-open');
        }
    });

    // === ПЛАВНАЯ ЗАГРУЗКА ФОТО ===
    function initImageLoader() {
        const images = document.querySelectorAll('img.content-media');
        
        images.forEach(img => {
            const showImg = () => {
                img.classList.add('loaded');
            };

            if (img.complete && img.naturalHeight !== 0) {
                showImg();
            } else {
                img.addEventListener('load', showImg);
                img.addEventListener('error', () => {
                    img.style.borderColor = 'red';
                    // Если картинка битая, все равно показываем (placeholder)
                    showImg();
                });
            }
        });
    }

    // === ИНИЦИАЛИЗАЦИЯ ===
    const savedTheme = localStorage.getItem('site_theme') || 'device';
    applyTheme(savedTheme);
    initImageLoader();

})();
</script>

</body>
</html>