<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WRATH OF LOH: Valhalla Edition</title>
    <style>
        :root {
            --primary: #9d4edd;
            --secondary: #ff9e00;
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text: #ffffff;
            --danger: #ff0055;
            --success: #00ff88;
            
            /* SBP Colors */
            --sbp-bg: #1d212e; /* Dark theme based on screenshots */
            --sbp-card: #282c3a;
            --sbp-text: #ffffff;
            --sbp-blue: #0057b6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; user-select: none; }

        body {
            background: radial-gradient(circle at center, #240046 0%, #10002b 100%);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- UI ELEMENTS --- */
        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            transition: 0.3s;
        }
        .back-btn:hover { background: rgba(255,255,255,0.2); }
        .back-btn svg { width: 24px; fill: white; }

        /* --- GAME CONTAINER --- */
        .game-container {
            width: 95%;
            max-width: 1200px;
            height: 90vh;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        /* --- SLOT GRID --- */
        .slot-area {
            position: relative;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .grid-frame {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 8px;
            height: 100%;
            padding: 15px;
            border: 2px solid var(--secondary);
            box-shadow: 0 0 20px var(--secondary);
        }

        .symbol {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            transition: transform 0.2s, opacity 0.3s;
            position: relative;
        }

        .symbol.pop { animation: pop 0.3s ease-out; }
        .symbol.win { 
            box-shadow: 0 0 15px var(--secondary); 
            background: rgba(255, 215, 0, 0.3);
            z-index: 2;
        }

        @keyframes pop {
            0% { transform: scale(0); }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        /* --- CONTROLS --- */
        .controls-area {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
        }

        /* INFO ROW (Level + Balance) */
        .info-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .info-box {
            text-align: center;
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        
        .label { font-size: 0.7rem; color: #aaa; text-transform: uppercase; margin-bottom: 2px; }
        .value { font-size: 1.2rem; font-weight: bold; color: white; }
        
        .level-title { font-size: 0.8rem; color: var(--secondary); margin-top: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        .level-bar { width: 100%; height: 4px; background: #333; margin-top: 5px; border-radius: 2px; overflow: hidden; }
        .level-progress { height: 100%; background: var(--success); width: 0%; transition: width 0.3s; }

        .balance-value { color: var(--secondary); text-shadow: 0 0 10px var(--secondary); }

        .message-box {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-weight: bold;
            color: #fff;
            font-size: 0.95rem;
            line-height: 1.2;
            padding: 0 5px;
        }

        .spin-btn {
            width: 100%;
            height: 80px;
            background: linear-gradient(180deg, var(--secondary) 0%, #aa6c00 100%);
            border: none;
            border-radius: 50px;
            font-size: 2rem;
            font-weight: 900;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 5px 0 #6e4600, 0 10px 10px rgba(0,0,0,0.5);
            transition: 0.1s;
        }
        .spin-btn:active { transform: translateY(5px); box-shadow: 0 0 0 #6e4600, inset 0 5px 10px rgba(0,0,0,0.5); }
        .spin-btn:disabled { filter: grayscale(1); cursor: not-allowed; }

        /* DEPOSIT BUTTON */
        .deposit-btn {
            width: 100%;
            padding: 12px;
            background: var(--success);
            color: #000;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 0 4px 0 #00aa55;
            transition: 0.1s;
        }
        .deposit-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #00aa55; }
        .deposit-btn:disabled { background: #555; color: #888; box-shadow: none; cursor: not-allowed; }

        .bet-controls { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
        .c-btn { background: var(--glass); border: 1px solid white; color: white; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .c-btn:hover { background: rgba(255,255,255,0.2); }
        .c-btn.help-btn { background: rgba(255, 255, 255, 0.15); border-color: var(--secondary); color: var(--secondary); font-weight: bold; }

        .settings-box { margin-top: auto; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .slider-group { margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .slider-group label { width: 30px; }
        input[type=range] { flex: 1; accent-color: var(--secondary); }
        
        .mute-btn { 
            border: 1px solid rgba(255,255,255,0.3); 
            background: rgba(0,0,0,0.2); 
            color: white; 
            cursor: pointer; 
            font-size: 1rem; 
            width: 35px; 
            height: 35px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .mute-btn:hover { background: rgba(255,255,255,0.1); }
        .mute-btn.muted { color: var(--danger); border-color: var(--danger); }

        .tip-box {
            font-size: 0.75rem; color: #bbb; text-align: center; margin-top: 5px; font-style: italic;
            min-height: 2.4em; display: flex; align-items: center; justify-content: center;
        }

        /* --- SBP OVERLAY (FAKE PAYMENT) --- */
        #sbp-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--sbp-bg);
            z-index: 9999;
            display: none; /* hidden by default */
            flex-direction: column;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* SBP Header */
        .sbp-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px;
            background: #232634;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .sbp-back-btn, .sbp-close-btn {
            background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; padding: 5px;
        }
        .sbp-title { font-size: 1.1rem; font-weight: 500; }
        .sbp-logo-sm { width: 40px; height: 40px; background: conic-gradient(from 0deg, #f00, #0f0, #00f); border-radius: 8px; clip-path: polygon(50% 0%, 0% 100%, 100% 100%); display:inline-block; margin-right: 10px; vertical-align: middle; }

        /* SBP Body */
        .sbp-body { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; align-items: center; }

        /* QR Section */
        .sbp-qr-card {
            background: var(--sbp-card);
            padding: 20px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 15px;
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
        }
        .qr-placeholder {
            width: 80px; height: 80px; background: white;
            background-image: linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000), linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            border-radius: 8px;
        }
        .sbp-qr-text h3 { font-size: 1rem; margin-bottom: 5px; }
        .sbp-qr-text p { font-size: 0.8rem; color: #8899a6; text-transform: uppercase; }

        /* Bank List */
        .sbp-bank-list {
            width: 100%; max-width: 600px;
            display: flex; flex-direction: column; gap: 10px;
        }
        .sbp-bank-item {
            background: var(--sbp-card);
            padding: 15px;
            border-radius: 12px;
            display: flex; align-items: center; justify-content: space-between;
            cursor: pointer;
            transition: 0.2s;
        }
        .sbp-bank-item:hover { background: #32384a; }
        .bank-info { display: flex; align-items: center; gap: 15px; }
        .bank-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; }
        
        .bi-tbank { background: #ffdd2d; color: black; }
        .bi-sber { background: #21a038; color: white; }
        .bi-vtb { background: #002882; color: white; }
        .bi-alpha { background: #ef3124; color: white; }
        .bi-sbp { background: conic-gradient(#e63946, #457b9d); color: transparent; }

        .arrow-right { color: #555; font-size: 1.2rem; }

        /* Payment Screen (Hidden by default) */
        .sbp-payment-screen {
            display: none; /* toggled via JS */
            width: 100%; max-width: 600px;
            flex-direction: column; gap: 20px;
            margin-top: 50px;
        }
        .pay-input-group {
            display: flex; flex-direction: column; gap: 10px;
        }
        .pay-label { color: #8899a6; font-size: 0.9rem; }
        .pay-input {
            background: transparent; border: none; border-bottom: 2px solid #555;
            color: white; font-size: 2rem; padding: 10px 0; width: 100%; outline: none;
        }
        .pay-input:focus { border-color: var(--success); }
        
        .pay-action-btn {
            background: linear-gradient(90deg, #6c5ce7, #a29bfe);
            color: white; padding: 18px; border: none; border-radius: 12px;
            font-size: 1.2rem; font-weight: bold; cursor: pointer; margin-top: 20px;
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.4);
        }
        .pay-action-btn:active { transform: scale(0.98); }

        /* Funny Cookie Banner */
        .sbp-cookie {
            margin-top: auto;
            background: #2d3436;
            width: 100%;
            padding: 15px;
            text-align: center;
            font-size: 0.8rem;
            color: #dfe6e9;
            border-top: 1px solid #636e72;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .cookie-btn {
            background: var(--primary); border: none; color: white; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.7rem;
        }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0; pointer-events: none; transition: 0.5s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: all; }

        .modal-content {
            width: 500px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 40px;
            text-align: center;
            position: relative;
        }
        .close-modal-btn {
            position: absolute; top: 10px; right: 10px;
            background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;
        }
        .modal-title { font-size: 1.8rem; color: var(--danger); margin-bottom: 20px; text-transform: uppercase; line-height: 1.1; }
        .modal-text { font-size: 0.95rem; line-height: 1.5; color: #ddd; margin-bottom: 30px; text-align: left; }
        .tos-check { display: flex; align-items: center; gap: 10px; justify-content: center; margin-bottom: 20px; }
        .confirm-btn {
            background: var(--danger); color: white; padding: 15px 40px; border: none; border-radius: 8px;
            font-size: 1.2rem; cursor: pointer; text-transform: uppercase; font-weight: bold;
        }
        .confirm-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Guide List */
        .guide-list { list-style: none; text-align: left; margin-bottom: 20px; }
        .guide-list li { margin-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; }
        .guide-list b { color: var(--secondary); }
        .guide-list span.sub { display: block; font-size: 0.8em; color: #999; margin-top: 2px; }

        /* --- VIDEO OVERLAY --- */
        #video-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 5000; background: black; display: none;
            pointer-events: none;
        }
        video { width: 100%; height: 100%; object-fit: cover; }

        /* --- MINI GAME CANVAS --- */
        #mini-game-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 4000; background: rgba(0,0,0,0.9);
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        canvas { border: 2px solid white; background: #70c5ce; }

        /* --- RESPONSIVE --- */
        @media (max-width: 900px) {
            .game-container { grid-template-columns: 1fr; grid-template-rows: 1fr auto; height: 100vh; }
            .grid-frame { gap: 2px; }
            .symbol { font-size: 1.5rem; }
            .controls-area { flex-direction: row; flex-wrap: wrap; justify-content: center; }
            .info-row { width: 100%; }
            .spin-btn { width: 80px; height: 80px; border-radius: 50%; font-size: 1rem; }
            .settings-box { width: 100%; padding-top: 10px; }
        }
    </style>
</head>
<body>

    <!-- Back Arrow -->
    <a href="main.htm" class="back-btn glass-panel">
        <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
    </a>

    <!-- Game Container -->
    <div class="game-container">
        <!-- Slot Grid -->
        <div class="slot-area glass-panel">
            <div class="grid-frame" id="grid">
                <!-- Symbols generated by JS -->
            </div>
        </div>

        <!-- Controls -->
        <div class="controls-area glass-panel">
            
            <div class="info-row">
                <!-- Level Info -->
                <div class="info-box">
                    <div class="label">–£—Ä–æ–≤–µ–Ω—å <span id="lvl-num">1</span></div>
                    <div class="level-title" id="lvl-title">–ú–∞–º–æ–Ω—Ç-–ù–æ–≤–∏—á–æ–∫</div>
                    <div class="level-bar"><div class="level-progress" id="lvl-progress"></div></div>
                </div>
                <!-- Balance Info -->
                <div class="info-box">
                    <div class="label">–ë–∞–ª–∞–Ω—Å (RUB)</div>
                    <div class="value balance-value" id="balance-display">0</div>
                </div>
            </div>
            
            <!-- Deposit Button -->
            <button class="deposit-btn" id="deposit-btn">–ü–û–ü–û–õ–ù–ò–¢–¨ (+)</button>

            <div class="message-box" id="msg-display">
                –ö—Ä—É—Ç–∏ –±–∞—Ä–∞–±–∞–Ω, –±—É–¥—É—â–∏–π –æ–ª–∏–≥–∞—Ä—Ö!
            </div>

            <div class="bet-controls">
                <button class="c-btn" id="bet-minus">-</button>
                <div style="font-weight:bold" id="bet-display">10 RUB</div>
                <button class="c-btn" id="bet-plus">+</button>
                <!-- Help Button -->
                <button class="c-btn help-btn" id="btn-guide">?</button>
            </div>

            <button class="spin-btn" id="spin-btn">SPIN</button>

            <div class="settings-box">
                <!-- Music Control -->
                <div class="slider-group">
                    <label>üéµ</label>
                    <input type="range" id="vol-music" min="0" max="1" step="0.1" value="0.5">
                    <button class="mute-btn" id="mute-music-btn">üîä</button>
                </div>
                <!-- SFX Control -->
                <div class="slider-group">
                    <label>üîä</label>
                    <input type="range" id="vol-sfx" min="0" max="1" step="0.1" value="0.8">
                    <button class="mute-btn" id="mute-sfx-btn">üîä</button>
                </div>
                
                <div class="tip-box" id="tip-display">
                    –°–æ–≤–µ—Ç: –ï—Å–ª–∏ –ø—Ä–æ–∏–≥—Ä–∞–ª –∫–≤–∞—Ä—Ç–∏—Ä—É, –∑–≤–æ–Ω–∏ –º–∞–º–µ.
                </div>
            </div>
        </div>
    </div>

    <!-- SBP PAYMENT OVERLAY -->
    <div id="sbp-overlay">
        <!-- Header -->
        <div class="sbp-header">
            <div style="display:flex; align-items:center;">
                <button class="sbp-back-btn" id="sbp-back-btn" style="display:none;">‚Üê</button>
                <div class="sbp-title" id="sbp-title-text">–°–∏—Å—Ç–µ–º–∞ –±—ã—Å—Ç—Ä—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π</div>
            </div>
            <button class="sbp-close-btn" id="sbp-close-btn">‚úï</button>
        </div>

        <!-- Main Body -->
        <div class="sbp-body">
            
            <!-- Screen 1: Select Method -->
            <div id="sbp-screen-select" style="width:100%; display:flex; flex-direction:column; align-items:center;">
                <!-- Fake QR -->
                <div class="sbp-qr-card">
                    <div class="qr-placeholder"></div>
                    <div class="sbp-qr-text">
                        <h3>–û–ø–ª–∞—Ç–∞ –ø–æ QR-–∫–æ–¥—É</h3>
                        <p>–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É (–µ—Å–ª–∏ –æ–Ω–∞ –µ—â–µ –µ—Å—Ç—å)</p>
                    </div>
                </div>

                <!-- Bank List -->
                <div class="sbp-bank-list">
                    <div class="sbp-bank-item" onclick="openPayment('T-–ë–∞–Ω–∫')">
                        <div class="bank-info">
                            <div class="bank-icon bi-tbank">–¢</div>
                            <span>–¢-–ë–∞–Ω–∫ (–¢–∏–Ω—å–∫–æ—Ñ—Ñ)</span>
                        </div>
                        <span class="arrow-right">‚Ä∫</span>
                    </div>
                    <div class="sbp-bank-item" onclick="openPayment('–°–±–µ—Ä–±–∞–Ω–∫')">
                        <div class="bank-info">
                            <div class="bank-icon bi-sber">‚úî</div>
                            <span>–°–±–µ—Ä–±–∞–Ω–∫</span>
                        </div>
                        <span class="arrow-right">‚Ä∫</span>
                    </div>
                    <div class="sbp-bank-item" onclick="openPayment('–í–¢–ë')">
                        <div class="bank-info">
                            <div class="bank-icon bi-vtb">‚â°</div>
                            <span>–ë–∞–Ω–∫ –í–¢–ë</span>
                        </div>
                        <span class="arrow-right">‚Ä∫</span>
                    </div>
                    <div class="sbp-bank-item" onclick="openPayment('–ê–ª—å—Ñ–∞')">
                        <div class="bank-info">
                            <div class="bank-icon bi-alpha">A</div>
                            <span>–ê–õ–¨–§–ê-–ë–ê–ù–ö</span>
                        </div>
                        <span class="arrow-right">‚Ä∫</span>
                    </div>
                    <div class="sbp-bank-item" onclick="openPayment('–û–ø–ª–∞—Ç–∞ —á–∞—Å—Ç—è–º–∏')">
                        <div class="bank-info">
                            <div class="bank-icon bi-sbp">√∑</div>
                            <span>–û–ø–ª–∞—Ç–∞ —á–∞—Å—Ç—è–º–∏ (–ü–æ—á–∫–∞–º–∏)</span>
                        </div>
                        <span class="arrow-right">‚Ä∫</span>
                    </div>
                </div>
            </div>

            <!-- Screen 2: Pay -->
            <div id="sbp-screen-pay" class="sbp-payment-screen">
                <h2 id="selected-bank-name" style="margin-bottom:20px; color: #8899a6;">–ë–∞–Ω–∫</h2>
                
                <div class="pay-input-group">
                    <label class="pay-label">–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (RUB)</label>
                    <input type="number" class="pay-input" value="5000" readonly>
                </div>

                <div class="pay-input-group" style="margin-top:20px;">
                    <label class="pay-label">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</label>
                    <div style="color:white; font-size: 1.1rem; padding: 5px 0;">–ù–∞–¥–µ–∂–¥–∞ –Ω–∞ —á—É–¥–æ</div>
                </div>

                <button class="pay-action-btn" id="confirm-pay-btn">–û–ü–õ–ê–¢–ò–¢–¨ 5000 ‚ÇΩ</button>
            </div>

            <!-- Funny Cookie Banner -->
            <div class="sbp-cookie">
                <span>üç™ –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º cookie, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤–∞—à–∏ –¥–æ–ª–≥–∏ –∏ —É—Ä–æ–≤–µ–Ω—å –æ—Ç—á–∞—è–Ω–∏—è.</span>
                <button class="cookie-btn" onclick="this.parentElement.style.display='none'">–°–º–∏—Ä–∏—Ç—å—Å—è</button>
            </div>
        </div>
    </div>

    <!-- Onboarding Modal -->
    <div class="modal-overlay glass-panel" id="modal-onboarding">
        <div class="modal-content glass-panel">
            <h2 class="modal-title">–ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥—É—à–∏ v2.0</h2>
            <div class="modal-text">
                –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ <b>Wrath of Loh</b>. –î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –≤—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–Ω—è—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —É—Å–ª–æ–≤–∏—è:<br><br>
                1. –ú—ã –ø–µ—Ä–µ–¥–∞–µ–º –≤–∞—à IP-–∞–¥—Ä–µ—Å –º–∏–∫—Ä–æ–∑–∞–π–º–∞–º "–î–µ–Ω—å–≥–∏ –º–∏–≥–æ–º".<br>
                2. –í–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤–∞—à–µ–π –±—ã–≤—à–µ–π.<br>
                3. –í—ã —Å–æ–≥–ª–∞—Å–Ω—ã –≤—ã–ø–ª–∞—á–∏–≤–∞—Ç—å –ø—Ä–æ–∏–≥—Ä—ã—à –æ—Ä–≥–∞–Ω–∞–º–∏ (–ø–æ—á–∫–∞ ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç).<br>
                4. –ñ–∞–ª–æ–±—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–æ–ª–Ω–æ–ª—É–Ω–∏–µ.<br>
                5. –í—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ, —á—Ç–æ —Å–ª–æ–≤–æ "–õ—É–¥–æ–º–∞–Ω–∏—è" –¥–ª—è –≤–∞—Å –ø—É—Å—Ç–æ–π –∑–≤—É–∫.<br>
                6. –ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É, –≤—ã –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ —Å—Ç–∞—Ç—É—Å "–ú–∞–º–æ–Ω—Ç".
            </div>
            <div class="tos-check">
                <input type="checkbox" id="tos-check">
                <label for="tos-check">–Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å—Ç—Ä–∞–¥–∞—Ç—å –∏ –ø–ª–∞—Ç–∏—Ç—å</label>
            </div>
            <button class="confirm-btn" id="start-game-btn" disabled>–ü–æ–¥–ø–∏—Å–∞—Ç—å –∫—Ä–æ–≤—å—é</button>
        </div>
    </div>

    <!-- Guide Modal (New) -->
    <div class="modal-overlay glass-panel" id="modal-guide">
        <div class="modal-content glass-panel">
            <button class="close-modal-btn" id="close-guide-btn">‚úï</button>
            <h2 class="modal-title">–ë–∏–±–ª–∏—è –õ—É–¥–æ–º–∞–Ω–∞</h2>
            <div class="modal-text">
                <ul class="guide-list">
                    <li><b>1. –ì–¥–µ –≤–∑—è—Ç—å –¥–µ–Ω—å–≥–∏?</b> 
                        <span class="sub">–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "–ü–û–ü–û–õ–ù–ò–¢–¨". –°–ë–ü —Å–ø–∞—Å–µ—Ç —Ç–≤–æ—é –¥—É—à—É (–∏ –æ–ø—É—Å—Ç–æ—à–∏—Ç –∫–∞—Ä—Ç—É).</span>
                    </li>
                    <li><b>2. –¢–∞–∫—Ç–∏–∫–∞ "–£–≤–µ—Ä–µ–Ω–Ω—ã–π –±–æ–º–∂":</b> 
                        <span class="sub">–ñ–º–∏ –∫–Ω–æ–ø–∫—É SPIN. –ï—Å–ª–∏ –ø—Ä–æ–∏–≥—Ä–∞–ª ‚Äî –∂–º–∏ —Å–∏–ª—å–Ω–µ–µ. –≠–∫—Ä–∞–Ω —Ç—Ä–µ—Å–Ω–µ—Ç, –Ω–æ —É–¥–∞—á–∞ –ø—Ä–∏–¥–µ—Ç.</span>
                    </li>
                    <li><b>3. –°–∏–º–≤–æ–ª—ã –∏ –∏—Ö —Å—É—Ç—å:</b> 
                        <br>‚ö° <b>–ú–æ–ª–Ω–∏—è:</b> –£–¥–∞—Ä —Ç–æ–∫–æ–º –ø–æ –∫–æ—à–µ–ª—å–∫—É (Scatter).
                        <br>üí© <b>–ö–æ—Ä–∏—á–Ω–µ–≤–æ–µ –∑–æ–ª–æ—Ç–æ:</b> –°–∞–º—ã–π —á–∞—Å—Ç—ã–π –≥–æ—Å—Ç—å. –°–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–≤–æ—é –∂–∏–∑–Ω—å.
                    </li>
                </ul>
                <p style="color: var(--secondary); font-weight: bold; text-align:center;">–ü–æ–º–Ω–∏: –ö–∞–∑–∏–Ω–æ –Ω–µ –æ–±—ã–≥—Ä–∞—Ç—å, –Ω–æ —Ç—ã –æ—Å–æ–±–µ–Ω–Ω—ã–π (–Ω–µ—Ç).</p>
            </div>
        </div>
    </div>

    <!-- Mini Game Modal -->
    <div id="mini-game-layer">
        <h2 style="color: white; margin-bottom: 10px;">FLAPPY MAMMOTH (Bonus Round)</h2>
        <canvas id="bird-canvas" width="320" height="480"></canvas>
        <p style="color: white; margin-top: 10px;">–ö–ª–∏–∫–Ω–∏ —á—Ç–æ–±—ã –ª–µ—Ç–µ—Ç—å. –ü—Ä–æ–ª–µ—Ç–∏—à—å —Ç—Ä—É–±—ã ‚Äî –ø–æ–ª—É—á–∏—à—å –±–∞–±–∫–∏.</p>
    </div>

    <!-- Video Layer -->
    <div id="video-layer"></div>

    <script>
        /**
         * WRATH OF LOH - CORE LOGIC
         */
        
        // --- CONSTANTS ---
        const LEVEL_TITLES = [
            "–ú–∞–º–æ–Ω—Ç-–ù–æ–≤–∏—á–æ–∫", // 0
            "–ò—Å–∫–∞—Ç–µ–ª—å –•–∞–ª—è–≤—ã", // 1
            "–ò–Ω–≤–µ—Å—Ç–æ—Ä –≤ –î–æ—à–∏—Ä–∞–∫", // 2
            "–°–ø–æ–Ω—Å–æ—Ä –ö–∞–∑–∏–Ω–æ", // 3
            "–ü–æ—á–µ—Ç–Ω—ã–π –î–æ–Ω–æ—Ä –ü–æ—á–µ–∫", // 4
            "–ì—Ä–æ–∑–∞ –ú–∏–∫—Ä–æ–∑–∞–π–º–æ–≤", // 5
            "–ú–∞—Å—Ç–µ—Ä –î–æ–ª–≥–æ–≤", // 6
            "–õ–µ–≥–µ–Ω–¥–∞ –õ–æ–º–±–∞—Ä–¥–∞", // 7
            "–í–ª–∞–¥–µ–ª–µ—Ü –í–æ–∑–¥—É—Ö–∞", // 8
            "–ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π –î–∏—Ä–µ–∫—Ç–æ—Ä –ë–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞" // 9+
        ];

        const TIPS = [
            "–°–æ–≤–µ—Ç: –ï—Å–ª–∏ –ø—Ä–æ–∏–≥—Ä–∞–ª –∫–≤–∞—Ä—Ç–∏—Ä—É, –∑–≤–æ–Ω–∏ –º–∞–º–µ.",
            "–§–∞–∫—Ç: 99% –ª—É–¥–æ–º–∞–Ω–æ–≤ —Å–¥–∞—é—Ç—Å—è –ø–µ—Ä–µ–¥ –¥–∂–µ–∫–ø–æ—Ç–æ–º.",
            "–°–æ–≤–µ—Ç: –ü—Ä–æ–¥–∞–π —Ç–µ–ª–µ—Ñ–æ–Ω, –æ—Ç—ã–≥—Ä–∞–µ—à—å—Å—è —Å —Ç–∞–∫—Å–æ—Ñ–æ–Ω–∞.",
            "–ú—É–¥—Ä–æ—Å—Ç—å: –î–µ–Ω—å–≥–∏ ‚Äî —ç—Ç–æ –±—É–º–∞–≥–∞. –ê –¥–æ–ª–≥–∏ ‚Äî —ç—Ç–æ –Ω–∞–≤—Å–µ–≥–¥–∞.",
            "–õ–∞–π—Ñ—Ö–∞–∫: –ö–æ–ª–ª–µ–∫—Ç–æ—Ä—ã –Ω–µ –Ω–∞–π–¥—É—Ç —Ç–µ–±—è –≤ –ª–µ—Å—É.",
            "–°–æ–≤–µ—Ç: –ö—Ä–∞—Å–Ω–æ–µ ‚Äî —ç—Ç–æ –∫ –¥–µ–Ω—å–≥–∞–º (–∏–ª–∏ –∫ –¥–∞–≤–ª–µ–Ω–∏—é).",
            "–°–æ–≤–µ—Ç: –í–æ–∑—å–º–∏ –∫—Ä–µ–¥–∏—Ç –Ω–∞ –±–∞–±—É—à–∫—É, –æ–Ω–∞ –ø–æ–π–º–µ—Ç.",
            "–§–∞–∫—Ç: –ö–∞–∑–∏–Ω–æ –≤—Å–µ–≥–¥–∞ –≤ –ø–ª—é—Å–µ, –∞ —Ç—ã –ø—Ä–æ—Å—Ç–æ —Ö–æ—Ä–æ—à–∏–π —á–µ–ª–æ–≤–µ–∫."
        ];

        const SYMBOLS = [
            { id: 'scatter', char: '‚ö°', val: 100, color: '#f0f' }, 
            { id: 'high1', char: 'üèõÔ∏è', val: 20, color: '#fa0' },
            { id: 'high2', char: 'üè∫', val: 15, color: '#0af' },
            { id: 'mid1', char: 'üõ°Ô∏è', val: 10, color: '#f00' },
            { id: 'mid2', char: 'üçá', val: 8, color: '#0f0' },
            { id: 'low1', char: 'üí©', val: 2, color: '#a52a2a' }, 
            { id: 'low2', char: 'ü•î', val: 1, color: '#d2b48c' },
            { id: 'low3', char: 'üìâ', val: 0.5, color: '#fff' }
        ];

        // --- STATE ---
        // Changed default balance to 0 as requested
        let state = {
            balance: parseFloat(localStorage.getItem('wol_balance_v3')) || 0,
            bet: 10,
            level: parseInt(localStorage.getItem('wol_level')) || 1,
            xp: parseInt(localStorage.getItem('wol_xp')) || 0,
            xpToNext: 1000, 
            isSpinning: false,
            musicVol: parseFloat(localStorage.getItem('wol_music')) || 0.5,
            sfxVol: parseFloat(localStorage.getItem('wol_sfx')) || 0.8,
            isMusicMuted: false,
            isSfxMuted: false,
            lastMusicVol: 0.5,
            lastSfxVol: 0.8
        };

        const ROWS = 5;
        const COLS = 6;
        
        // --- DOM ELEMENTS ---
        const elGrid = document.getElementById('grid');
        const elBalance = document.getElementById('balance-display');
        const elBet = document.getElementById('bet-display');
        const elMsg = document.getElementById('msg-display');
        const elLvlNum = document.getElementById('lvl-num');
        const elLvlTitle = document.getElementById('lvl-title');
        const elLvlProgress = document.getElementById('lvl-progress');
        const elTip = document.getElementById('tip-display');

        const btnSpin = document.getElementById('spin-btn');
        const btnDeposit = document.getElementById('deposit-btn'); // New button
        const btnBetPlus = document.getElementById('bet-plus');
        const btnBetMinus = document.getElementById('bet-minus');
        
        const btnGuide = document.getElementById('btn-guide');
        const modalGuide = document.getElementById('modal-guide');
        const btnCloseGuide = document.getElementById('close-guide-btn');
        const btnMuteMusic = document.getElementById('mute-music-btn');
        const btnMuteSfx = document.getElementById('mute-sfx-btn');
        const sliderMusic = document.getElementById('vol-music');
        const sliderSfx = document.getElementById('vol-sfx');

        // SBP Elements
        const sbpOverlay = document.getElementById('sbp-overlay');
        const sbpCloseBtn = document.getElementById('sbp-close-btn');
        const sbpBackBtn = document.getElementById('sbp-back-btn');
        const sbpScreenSelect = document.getElementById('sbp-screen-select');
        const sbpScreenPay = document.getElementById('sbp-screen-pay');
        const sbpTitle = document.getElementById('sbp-title-text');
        const sbpBankName = document.getElementById('selected-bank-name');
        const btnConfirmPay = document.getElementById('confirm-pay-btn');

        // --- AUDIO ENGINE ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playTone(freq, type, duration) {
            if(state.isSfxMuted || state.sfxVol <= 0) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            
            gain.gain.setValueAtTime(state.sfxVol * 0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playSound(type) {
            if(state.isSfxMuted) return;
            if(type === 'spin') {
                playTone(400, 'sine', 0.1);
                setTimeout(() => playTone(600, 'sine', 0.1), 100);
            } else if (type === 'win') {
                playTone(500, 'square', 0.2);
                setTimeout(() => playTone(800, 'square', 0.4), 200);
            } else if (type === 'loss') {
                playTone(150, 'sawtooth', 0.5);
            } else if (type === 'deposit') {
                playTone(1000, 'sine', 0.1);
                setTimeout(() => playTone(1500, 'sine', 0.3), 100);
            }
        }

        // --- INIT ---
        function init() {
            calculateXpTarget();
            updateUI();
            checkOnboarding();
            generateGrid(true);
            rotateTips();
            
            sliderMusic.value = state.musicVol;
            sliderSfx.value = state.sfxVol;

            setupAudioControls();
            
            // Listeners
            btnGuide.addEventListener('click', () => modalGuide.classList.add('active'));
            btnCloseGuide.addEventListener('click', () => modalGuide.classList.remove('active'));

            // SBP Listeners
            btnDeposit.addEventListener('click', () => {
                if(!state.isSpinning) openSbp();
            });
            sbpCloseBtn.addEventListener('click', closeSbp);
            sbpBackBtn.addEventListener('click', showSbpBankList);
            btnConfirmPay.addEventListener('click', processPayment);

            setInterval(rotateTips, 8000);
        }

        // --- SBP LOGIC ---
        function openSbp() {
            sbpOverlay.style.display = 'flex';
            showSbpBankList();
        }

        function closeSbp() {
            sbpOverlay.style.display = 'none';
        }

        function showSbpBankList() {
            sbpScreenSelect.style.display = 'flex';
            sbpScreenPay.style.display = 'none';
            sbpBackBtn.style.display = 'none';
            sbpTitle.textContent = "–°–∏—Å—Ç–µ–º–∞ –±—ã—Å—Ç—Ä—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π";
        }

        // Exposed globally for onclick in HTML
        window.openPayment = function(bankName) {
            sbpScreenSelect.style.display = 'none';
            sbpScreenPay.style.display = 'flex';
            sbpBackBtn.style.display = 'block';
            sbpTitle.textContent = "–û–ø–ª–∞—Ç–∞";
            sbpBankName.textContent = bankName;
        }

        function processPayment() {
            // Fake loading logic could go here
            state.balance += 5000;
            playSound('deposit');
            elMsg.textContent = "–î–ï–ü–û–ó–ò–¢ –£–°–ü–ï–®–ï–ù! –¢–´ –ë–û–ì–ê–¢ (–≤—Ä–µ–º–µ–Ω–Ω–æ)";
            elMsg.style.color = "#0f0";
            updateUI();
            closeSbp();
        }

        function setupAudioControls() {
             sliderMusic.addEventListener('input', (e) => {
                state.musicVol = parseFloat(e.target.value);
                localStorage.setItem('wol_music', state.musicVol);
            });
            sliderSfx.addEventListener('input', (e) => {
                state.sfxVol = parseFloat(e.target.value);
                localStorage.setItem('wol_sfx', state.sfxVol);
            });
            btnMuteMusic.addEventListener('click', () => toggleMute('music'));
            btnMuteSfx.addEventListener('click', () => toggleMute('sfx'));
        }

        function toggleMute(type) {
            if(type === 'music') {
                state.isMusicMuted = !state.isMusicMuted;
                if(state.isMusicMuted) {
                    state.lastMusicVol = state.musicVol || 0.5;
                    state.musicVol = 0;
                    sliderMusic.value = 0;
                    btnMuteMusic.textContent = 'üîá';
                    btnMuteMusic.classList.add('muted');
                } else {
                    state.musicVol = state.lastMusicVol;
                    sliderMusic.value = state.musicVol;
                    btnMuteMusic.textContent = 'üîä';
                    btnMuteMusic.classList.remove('muted');
                }
            } else {
                state.isSfxMuted = !state.isSfxMuted;
                if(state.isSfxMuted) {
                    state.lastSfxVol = state.sfxVol || 0.8;
                    state.sfxVol = 0;
                    sliderSfx.value = 0;
                    btnMuteSfx.textContent = 'üîá';
                    btnMuteSfx.classList.add('muted');
                } else {
                    state.sfxVol = state.lastSfxVol;
                    sliderSfx.value = state.sfxVol;
                    btnMuteSfx.textContent = 'üîä';
                    btnMuteSfx.classList.remove('muted');
                }
            }
        }

        function calculateXpTarget() {
            state.xpToNext = 1000 + (state.level - 1) * 500;
        }

        function addXp(amount) {
            state.xp += amount;
            if(state.xp >= state.xpToNext) {
                state.xp -= state.xpToNext;
                state.level++;
                calculateXpTarget();
                playSound('levelup');
                elLvlTitle.style.color = "#fff";
                setTimeout(() => elLvlTitle.style.color = "var(--secondary)", 500);
            }
            saveState();
            updateUI();
        }

        function getLevelTitle() {
            const idx = state.level - 1;
            if(idx < LEVEL_TITLES.length) return LEVEL_TITLES[idx];
            return LEVEL_TITLES[LEVEL_TITLES.length - 1];
        }

        function rotateTips() {
            const randTip = TIPS[Math.floor(Math.random() * TIPS.length)];
            elTip.style.opacity = 0;
            setTimeout(() => {
                elTip.textContent = randTip;
                elTip.style.opacity = 1;
            }, 300);
        }

        function checkOnboarding() {
            if (!localStorage.getItem('wol_onboarded_v3')) {
                const modal = document.getElementById('modal-onboarding');
                const check = document.getElementById('tos-check');
                const btn = document.getElementById('start-game-btn');
                
                modal.classList.add('active');
                
                check.addEventListener('change', () => {
                    btn.disabled = !check.checked;
                });
                
                btn.addEventListener('click', () => {
                    localStorage.setItem('wol_onboarded_v3', 'true');
                    localStorage.setItem('wol_balance_v3', 0); // Start with 0
                    state.balance = 0;
                    state.level = 1;
                    state.xp = 0;
                    updateUI();
                    modal.classList.remove('active');
                });
            }
        }

        function generateGrid(isInitial = false) {
            elGrid.innerHTML = '';
            for (let i = 0; i < ROWS * COLS; i++) {
                const cell = document.createElement('div');
                cell.className = 'symbol glass-panel';
                if (!isInitial) {
                    const sym = getRandomSymbol();
                    cell.textContent = sym.char;
                    cell.dataset.id = sym.id;
                    cell.style.color = sym.color;
                    cell.classList.add('pop');
                } else {
                    cell.textContent = '?';
                }
                elGrid.appendChild(cell);
            }
        }

        function getRandomSymbol() {
            const rand = Math.random();
            if (rand < 0.02) return SYMBOLS[0]; 
            if (rand < 0.08) return SYMBOLS[1];
            if (rand < 0.15) return SYMBOLS[2];
            if (rand < 0.25) return SYMBOLS[3];
            if (rand < 0.40) return SYMBOLS[4];
            if (rand < 0.60) return SYMBOLS[5];
            if (rand < 0.80) return SYMBOLS[6];
            return SYMBOLS[7];
        }

        // --- GAMEPLAY LOOP ---
        btnSpin.addEventListener('click', () => {
            if (state.isSpinning || state.balance < state.bet) {
                if(state.balance < state.bet) elMsg.textContent = "–î–µ–Ω–µ–≥ –Ω–µ—Ç? –ñ–º–∏ –ü–û–ü–û–õ–ù–ò–¢–¨!";
                return;
            }

            state.isSpinning = true;
            state.balance -= state.bet;
            addXp(state.bet);

            updateUI(); // This will disable the deposit button
            playSound('spin');
            elMsg.textContent = "–ö—Ä—É—Ç–∏–º –±–∞—Ä–∞–±–∞–Ω (–∏ —Ç–≤–æ—é –∂–∏–∑–Ω—å)...";
            
            elGrid.style.animation = 'shake 0.5s';
            
            setTimeout(() => {
                elGrid.style.animation = '';
                generateGrid();
                checkWin();
            }, 500);
        });

        function checkWin() {
            const cells = Array.from(elGrid.children);
            const counts = {};
            
            cells.forEach(cell => {
                const id = cell.dataset.id;
                counts[id] = (counts[id] || 0) + 1;
            });

            let totalWin = 0;
            let winningTypes = [];

            SYMBOLS.forEach(sym => {
                if (counts[sym.id] >= 8) {
                    let multiplier = 1;
                    if(counts[sym.id] >= 10) multiplier = 1.5;
                    if(counts[sym.id] >= 12) multiplier = 2;
                    
                    const win = state.bet * sym.val * (counts[sym.id] / 20) * multiplier; 
                    totalWin += win;
                    winningTypes.push(sym.id);
                }
            });

            if (totalWin > 0) {
                processWin(totalWin, winningTypes, cells);
            } else {
                processLoss();
            }
        }

        function processWin(amount, types, cells) {
            playSound('win');
            
            cells.forEach(cell => {
                if (types.includes(cell.dataset.id)) {
                    cell.classList.add('win');
                }
            });

            state.balance += amount;
            
            setTimeout(() => {
                elMsg.textContent = `–í–´–ò–ì–†–´–®: +${Math.floor(amount)} RUB`;
                elMsg.style.color = "#0f0";
                state.isSpinning = false; // Re-enable
                updateUI();
                
                if (amount > state.bet * 20) {
                    setTimeout(() => offerMiniGame(), 1000);
                }
            }, 1000);
        }

        function processLoss() {
            playSound('loss');
            elMsg.textContent = "–ù–µ –ø–æ–≤–µ–∑–ª–æ... –ø–æ–ø—Ä–æ–±—É–π –∑–∞–π–º!";
            elMsg.style.color = "#f00";
            state.isSpinning = false; // Re-enable
            updateUI();
        }

        // --- MINI GAME: FLAPPY MAMMOTH ---
        let miniGameLoop;
        
        function offerMiniGame() {
            if(!confirm("–°–£–ü–ï–† –í–´–ò–ì–†–´–®! –•–æ—á–µ—à—å —Ä–∏—Å–∫–Ω—É—Ç—å –∏ —É–¥–≤–æ–∏—Ç—å –Ω–∞ Flappy Mammoth?")) {
                return;
            }
            
            const layer = document.getElementById('mini-game-layer');
            layer.style.display = 'flex';
            const canvas = document.getElementById('bird-canvas');
            const ctx = canvas.getContext('2d');
            
            let bird = { x: 50, y: 150, v: 0 };
            let pipes = [];
            let score = 0;
            let frame = 0;
            let gameOver = false;

            function reset() {
                bird = { x: 50, y: 150, v: 0 };
                pipes = [];
                score = 0;
                frame = 0;
                gameOver = false;
            }
            
            reset();

            canvas.onclick = () => { bird.v = -6; };

            function loop() {
                if(gameOver) return;
                
                bird.v += 0.3; 
                bird.y += bird.v;
                frame++;

                if(frame % 100 === 0) {
                    pipes.push({ x: 320, h: Math.random() * 200 + 50 });
                }

                pipes.forEach(p => p.x -= 2);
                pipes = pipes.filter(p => p.x > -50);

                if(bird.y > 480 || bird.y < 0) endGame();
                pipes.forEach(p => {
                    if(bird.x + 20 > p.x && bird.x < p.x + 40) {
                        if(bird.y < p.h || bird.y > p.h + 100) endGame();
                    }
                    if(p.x === 50) score++;
                });

                ctx.fillStyle = '#70c5ce';
                ctx.fillRect(0,0, 320, 480);
                ctx.fillStyle = 'brown'; 
                ctx.fillRect(bird.x, bird.y, 20, 20);
                ctx.fillStyle = 'green';
                pipes.forEach(p => {
                    ctx.fillRect(p.x, 0, 40, p.h);
                    ctx.fillRect(p.x, p.h + 100, 40, 480 - p.h - 100);
                });

                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.fillText(`Score: ${score}`, 10, 30);

                miniGameLoop = requestAnimationFrame(loop);
            }

            function endGame() {
                gameOver = true;
                cancelAnimationFrame(miniGameLoop);
                const bonus = score * state.bet;
                alert(`–¢—ã –≤—Ä–µ–∑–∞–ª—Å—è –≤ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–∞! –ù–æ –∑–∞—Ä–∞–±–æ—Ç–∞–ª –±–æ–Ω—É—Å: ${bonus} RUB`);
                state.balance += bonus;
                updateUI();
                layer.style.display = 'none';
            }

            loop();
        }

        // --- UTILS ---
        function saveState() {
            localStorage.setItem('wol_balance_v3', state.balance);
            localStorage.setItem('wol_level', state.level);
            localStorage.setItem('wol_xp', state.xp);
        }

        function updateUI() {
            elBalance.textContent = state.balance.toFixed(0);
            elBet.textContent = `${state.bet} RUB`;
            
            elLvlNum.textContent = state.level;
            elLvlTitle.textContent = getLevelTitle();
            const pct = (state.xp / state.xpToNext) * 100;
            elLvlProgress.style.width = `${pct}%`;

            // Disable deposit if spinning
            btnDeposit.disabled = state.isSpinning;
            btnSpin.disabled = state.isSpinning;

            saveState();
            
            btnBetMinus.onclick = () => { if(state.bet > 10) state.bet -= 10; updateUI(); };
            btnBetPlus.onclick = () => { state.bet += 10; updateUI(); };
        }

        // Run
        init();

    </script>
</body>
</html>
